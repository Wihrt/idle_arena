repositories:
  - name: stable
    url: https://charts.helm.sh/stable
  - name: bitnami
    url: https://charts.bitnami.com/bitnami

templates:
  environment: &environment
    values:
    - envs/common.gotmpl
    - envs/{{.Environment.Name }}.gotmpl
    - mongo:
        host: mongo-mongodb.arena-{{.Environment.Name }}
    - bot:
        backend:
          host: backend.arena-{{.Environment.Name }}

  release: &release
    chart: ../helm/{{`{{ .Release.Name }}`}}
    namespace: arena-{{`{{.Environment.Name }}`}}
    createNamespace: true
    missingFileHandler: Warn
    values:
      - config/{{`{{ .Release.Name }}`}}/values.gotmpl
      - config/{{`{{ .Release.Name }}`}}/{{`{{.Environment.Name }}`}}/values.yaml
    secrets:
      - config/{{`{{ .Release.Name }}`}}/{{`{{.Environment.Name }}`}}/secrets.yaml


environments:
  develop:
    <<: *environment
  production:
    <<: *environment


releases:
- name: bot
  <<: *release
  needs:
    - backend
- name: backend
  <<: *release
  needs:
    - mongo
- name: mongo
  <<: *release
  chart: bitnami/mongodb


