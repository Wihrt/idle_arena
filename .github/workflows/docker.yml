name: Docker Image CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

env:
  DOCKER_USER: megalooo

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Docker login
      env:
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
      run: docker login -u ${{ env.DOCKER_USER }} -p $DOCKER_PASSWORD

    - name: Build the Docker image
      env:
        IMAGE: idle_arena/bot
      run: |-
        cd golang
        echo docker build --build-arg GOBINARY=arenaBot --build-arg GOFILE=./bot/bot.go -t ${{ env.DOCKER_USER }}/${{ env.IMAGE }}:${{ github.sha }}.
        docker build --build-arg GOBINARY=arenaBot --build-arg GOFILE=./bot/bot.go -t ${{ env.DOCKER_USER }}/${{ env.IMAGE }}:${{ github.sha }}.
        docker push ${{ env.DOCKER_USER }}/${{ env.IMAGE }}:${{ github.sha }}
